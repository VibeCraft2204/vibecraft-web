---
import { getCollection } from 'astro:content';
import PageLayout from '../layouts/PageLayout.astro';
import ProjectCard from '../components/ProjectCard.astro';
import ServiceCard from '../components/ServiceCard.astro';
import Stats from '../components/Stats.astro';
import ProcessStep from '../components/ProcessStep.astro';
import { services } from '../data/services';

const base = import.meta.env.BASE_URL.replace(/\/?$/, '/');

const allProjects = await getCollection('projects');
const featuredProjects = allProjects
  .filter((p) => p.data.featured)
  .sort((a, b) => {
    const aDate = a.data.period_start || '0000';
    const bDate = b.data.period_start || '0000';
    return aDate > bDate ? -1 : 1;
  })
  .slice(0, 8);

const stats = [
  { number: '50+', label: '프로젝트' },
  { number: '20+', label: '기술 스택' },
  { number: '4–6', label: '팀 규모' },
  { number: '2–4', label: '평균 개월' },
];

const process = [
  {
    number: '01',
    title: '요구사항 분석',
    description:
      '비즈니스 목표와 기술 요구사항을 파악합니다. 범위, 일정, 우선순위를 함께 정의합니다.',
  },
  {
    number: '02',
    title: '설계 · 프로토타입',
    description:
      '아키텍처를 설계하고 핵심 기능의 프로토타입을 빠르게 만들어 방향을 검증합니다.',
  },
  {
    number: '03',
    title: '개발 · 이터레이션',
    description:
      '2주 단위 스프린트로 개발하며, 매 주기마다 진행 상황을 공유하고 피드백을 반영합니다.',
  },
  {
    number: '04',
    title: '배포 · 운영 지원',
    description:
      '안정적인 배포 파이프라인을 구축하고, 출시 후 모니터링과 유지보수를 지원합니다.',
  },
];
---

<PageLayout>
  <!-- Hero -->
  <section class="hero">
    <div class="container hero-container">
      <div class="hero-content">
        <div class="reveal">
          <p class="hero-eyebrow">Digital Product Studio</p>
        </div>
        <div class="reveal reveal-delay-1">
          <h1>We build<br/>digital products<span class="dot">.</span></h1>
        </div>
        <div class="reveal reveal-delay-2">
          <p class="hero-desc">
            기획부터 개발, 운영까지 — 아이디어를 제품으로 만듭니다.
          </p>
        </div>
        <div class="reveal reveal-delay-3 hero-ctas">
          <a href={`${base}#work`} class="hero-btn-primary">프로젝트 보기</a>
          <a href={`${base}#contact`} class="hero-btn-secondary">문의하기 <span class="arrow">&rarr;</span></a>
        </div>
      </div>
      <div class="hero-meta reveal reveal-delay-4">
        <div class="hero-stat">
          <span class="hero-stat-num">50+</span>
          <span class="hero-stat-label">Projects</span>
        </div>
        <div class="hero-stat">
          <span class="hero-stat-num">20+</span>
          <span class="hero-stat-label">Tech Stacks</span>
        </div>
      </div>
    </div>
    <div class="hero-scroll-hint reveal reveal-delay-5">
      <span>Scroll</span>
      <div class="scroll-line"></div>
    </div>
  </section>

  <!-- Selected Work -->
  <section id="work" class="section">
    <div class="container">
      <div class="section-header reveal">
        <div class="section-label">Work</div>
        <div class="section-title-row">
          <h2>Selected Work</h2>
          <span class="section-count">{allProjects.length} Projects</span>
        </div>
      </div>
      <div class="work-grid">
        {
          featuredProjects.map((project, i) => (
            <div class={`reveal reveal-delay-${(i % 4) + 1}`}>
              <ProjectCard
                title={project.data.title}
                summary={project.data.summary}
                tech={project.data.tech}
                slug={project.slug}
                field={project.data.field}
                cover={project.data.cover}
                index={i + 1}
              />
            </div>
          ))
        }
      </div>
      <div class="reveal view-all-wrap">
        <a href={`${base}projects/`} class="view-all">
          <span>더보기</span>
          <span class="arrow">&rarr;</span>
        </a>
      </div>
    </div>
  </section>

  <!-- Services (Dark) -->
  <section id="services" class="section section-dark">
    <div class="container">
      <div class="section-header reveal">
        <div class="section-label dark-label">What we do</div>
        <h2 class="dark-title">Services</h2>
      </div>
      <div class="services-grid">
        {
          services.map((s, i) => (
            <div class={`reveal reveal-delay-${i + 1}`}>
              <ServiceCard
                number={s.number}
                title={s.title}
                description={s.description}
                href={`${base}services/${s.slug}/`}
              />
            </div>
          ))
        }
      </div>
    </div>
  </section>

  <!-- Team -->
  <section id="team" class="section">
    <div class="container">
      <div class="section-header reveal">
        <div class="section-label">About</div>
        <h2>Team</h2>
      </div>
      <div class="about-content">
        <div class="reveal reveal-delay-1">
          <div class="lead">
            작은 팀, 빠른 실행.<br />
            풀스택으로 움직이는<br />
            프로덕트 팀입니다.
          </div>
        </div>
        <div class="reveal reveal-delay-2">
          <div class="body">
            <p>
              VibeCraft는 4–6명 규모의 소수정예 팀입니다. 프론트엔드, 백엔드,
              데이터 엔지니어링, 인프라까지 — 하나의 팀이 전체 제품 개발
              사이클을 책임집니다.
            </p>
            <p>
              작은 규모이기에 가능한 것들이 있습니다. 빠른 의사결정, 유연한 구조
              변경, 그리고 클라이언트와의 직접 소통. 불필요한 계층 없이 만드는
              사람이 곧 소통하는 사람입니다.
            </p>
          </div>
        </div>
      </div>
      <div class="team-roles reveal reveal-delay-3">
        <div class="role-list">
          <span class="role">Frontend</span>
          <span class="role">Backend</span>
          <span class="role">Data / AI</span>
          <span class="role">Infrastructure</span>
        </div>
      </div>
      <div class="reveal reveal-delay-4">
        <Stats items={stats} />
      </div>
    </div>
  </section>

  <!-- Process (Dark) -->
  <section id="process" class="section section-dark">
    <div class="container">
      <div class="section-header reveal">
        <div class="section-label dark-label">How we work</div>
        <h2 class="dark-title">Process</h2>
      </div>
      <div class="process-grid">
        {
          process.map((p, i) => (
            <div class={`reveal reveal-delay-${i + 1}`}>
              <ProcessStep
                number={p.number}
                title={p.title}
                description={p.description}
              />
            </div>
          ))
        }
      </div>
    </div>
  </section>

  <!-- Contact CTA -->
  <section id="contact" class="section cta-section">
    <div class="container">
      <div class="reveal">
        <p class="cta-eyebrow">Get in touch</p>
      </div>
      <div class="reveal reveal-delay-1">
        <h2>
          다음 프로젝트,<br />
          함께 만들어 볼까요?
        </h2>
      </div>
      <div class="reveal reveal-delay-2">
        <p class="cta-desc">프로젝트 문의부터 기술 상담까지, 편하게 연락주세요.</p>
      </div>
      <div class="reveal reveal-delay-3">
        <a
          href="https://docs.google.com/forms/d/e/1FAIpQLScPYEgY-bhxM31JWZsoHIaNdFGE-Dy3HJjn41500A0O7IeeOQ/viewform"
          target="_blank"
          rel="noopener"
          class="cta-btn">
          <span>프로젝트 문의하기</span>
          <span class="arrow">&rarr;</span>
        </a>
      </div>
    </div>
  </section>
</PageLayout>

<style>
  /* ===== Hero ===== */
  .hero {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    position: relative;
    padding-top: 64px;
  }

  .hero-container {
    flex: 1;
    width: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding-top: 40px;
    padding-bottom: 80px;
  }

  .hero-content {
    max-width: 800px;
  }

  .hero-eyebrow {
    font-size: 13px;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--text-secondary);
    margin-bottom: 24px;
    font-weight: 400;
  }

  .hero h1 {
    font-size: clamp(48px, 6.5vw, 80px);
    font-weight: 700;
    letter-spacing: -0.035em;
    line-height: 1.05;
    color: var(--text);
  }

  .dot {
    color: var(--text-secondary);
  }

  .hero-desc {
    margin-top: 28px;
    font-size: 18px;
    color: var(--text-secondary);
    max-width: 480px;
    line-height: 1.7;
    font-weight: 400;
  }

  .hero-ctas {
    margin-top: 40px;
    display: flex;
    align-items: center;
    gap: 32px;
  }

  .hero-btn-primary {
    display: inline-flex;
    align-items: center;
    padding: 14px 32px;
    background: var(--text);
    color: var(--bg);
    font-size: 14px;
    font-weight: 500;
    letter-spacing: 0.02em;
    border-radius: 2px;
    transition: transform var(--transition-normal), box-shadow var(--transition-normal);
  }

  .hero-btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
  }

  .hero-btn-secondary {
    font-size: 14px;
    font-weight: 500;
    color: var(--text-secondary);
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: color var(--transition-fast);
  }

  .hero-btn-secondary:hover {
    color: var(--text);
  }

  .hero-btn-secondary .arrow {
    display: inline-block;
    transition: transform var(--transition-fast);
  }

  .hero-btn-secondary:hover .arrow {
    transform: translateX(4px);
  }

  .hero-meta {
    display: flex;
    gap: 48px;
    margin-top: auto;
    padding-top: 40px;
    border-top: 1px solid var(--border);
  }

  .hero-stat {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .hero-stat-num {
    font-size: 28px;
    font-weight: 700;
    letter-spacing: -0.03em;
  }

  .hero-stat-label {
    font-size: 12px;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--text-secondary);
  }

  .hero-scroll-hint {
    position: absolute;
    bottom: 32px;
    right: var(--container-padding);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
  }

  .hero-scroll-hint span {
    font-size: 11px;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--text-tertiary);
    writing-mode: vertical-rl;
  }

  .scroll-line {
    width: 1px;
    height: 48px;
    background: var(--border);
    position: relative;
    overflow: hidden;
  }

  .scroll-line::after {
    content: '';
    position: absolute;
    top: -100%;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--text);
    animation: scroll-down 2s ease-in-out infinite;
  }

  @keyframes scroll-down {
    0% { top: -100%; }
    50% { top: 100%; }
    100% { top: 100%; }
  }

  /* ===== Section Header ===== */
  .section-header {
    margin-bottom: 64px;
  }

  .section-label {
    font-size: 12px;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--text-tertiary);
    margin-bottom: 12px;
    font-weight: 400;
  }

  .dark-label {
    color: var(--dark-text-secondary);
  }

  .section-title-row {
    display: flex;
    align-items: baseline;
    justify-content: space-between;
  }

  .section-header h2, .dark-title {
    font-size: clamp(32px, 4vw, 48px);
    font-weight: 700;
    letter-spacing: -0.03em;
    line-height: 1.1;
  }

  .dark-title {
    color: var(--dark-text);
  }

  .section-count {
    font-size: 13px;
    color: var(--text-tertiary);
    letter-spacing: 0.04em;
  }

  /* ===== Work Grid ===== */
  .work-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 40px 28px;
  }

  .view-all-wrap {
    margin-top: 56px;
    text-align: center;
  }

  .view-all {
    display: inline-flex;
    align-items: center;
    gap: 12px;
    font-size: 14px;
    font-weight: 500;
    color: var(--text);
    padding: 12px 28px;
    border: 1px solid var(--border);
    border-radius: 2px;
    transition: all var(--transition-normal);
  }

  .view-all:hover {
    background: var(--text);
    color: var(--bg);
    border-color: var(--text);
  }

  .view-all .arrow {
    display: inline-block;
    transition: transform var(--transition-fast);
  }

  .view-all:hover .arrow {
    transform: translateX(4px);
  }

  /* ===== Services Grid (Dark) ===== */
  .services-grid {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 1px;
    background: var(--dark-border);
  }

  .services-grid > :global(:nth-child(-n + 3)) {
    grid-column: span 2;
  }

  .services-grid > :global(:nth-child(4)) {
    grid-column: 1 / span 3;
  }

  .services-grid > :global(:nth-child(5)) {
    grid-column: 4 / span 3;
  }

  /* ===== Team / About ===== */
  .about-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 80px;
  }

  .lead {
    font-size: clamp(24px, 3vw, 32px);
    font-weight: 600;
    letter-spacing: -0.025em;
    line-height: 1.4;
  }

  .body {
    font-size: 15px;
    color: var(--text-secondary);
    line-height: 1.8;
  }

  .body p + p {
    margin-top: 16px;
  }

  .team-roles {
    margin-top: 48px;
    margin-bottom: 48px;
    padding-top: 48px;
    border-top: 1px solid var(--border);
  }

  .role-list {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
  }

  .role {
    font-size: 13px;
    letter-spacing: 0.06em;
    padding: 8px 20px;
    border: 1px solid var(--border);
    border-radius: 100px;
    color: var(--text-secondary);
    transition: all var(--transition-fast);
  }

  .role:hover {
    background: var(--text);
    color: var(--bg);
    border-color: var(--text);
  }

  /* ===== Process Grid (Dark) ===== */
  .process-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1px;
    background: var(--dark-border);
  }

  /* ===== Contact CTA ===== */
  .cta-section {
    text-align: center;
    padding-top: clamp(100px, 12vw, 160px);
    padding-bottom: clamp(100px, 12vw, 160px);
  }

  .cta-eyebrow {
    font-size: 12px;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--text-tertiary);
    margin-bottom: 24px;
  }

  .cta-section h2 {
    font-size: clamp(36px, 5vw, 56px);
    font-weight: 700;
    letter-spacing: -0.03em;
    line-height: 1.15;
  }

  .cta-desc {
    margin-top: 20px;
    color: var(--text-secondary);
    font-size: 16px;
  }

  .cta-btn {
    display: inline-flex;
    align-items: center;
    gap: 12px;
    margin-top: 40px;
    padding: 16px 40px;
    background: var(--text);
    color: var(--bg);
    font-size: 15px;
    font-weight: 500;
    border-radius: 2px;
    transition: transform var(--transition-normal), box-shadow var(--transition-normal);
  }

  .cta-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 24px rgba(0, 0, 0, 0.15);
  }

  .cta-btn .arrow {
    display: inline-block;
    transition: transform var(--transition-fast);
  }

  .cta-btn:hover .arrow {
    transform: translateX(4px);
  }

  /* ===== Responsive ===== */
  @media (max-width: 768px) {
    .hero {
      min-height: auto;
      padding-top: 64px;
    }

    .hero-container {
      padding-top: 60px;
      padding-bottom: 60px;
    }

    .hero-meta {
      gap: 32px;
    }

    .hero-scroll-hint {
      display: none;
    }

    .hero-ctas {
      flex-direction: column;
      align-items: flex-start;
      gap: 16px;
    }

    .work-grid {
      grid-template-columns: 1fr;
      gap: 32px;
    }

    .services-grid {
      grid-template-columns: 1fr;
    }

    .services-grid > :global(:nth-child(-n + 3)),
    .services-grid > :global(:nth-child(4)),
    .services-grid > :global(:nth-child(5)) {
      grid-column: span 1;
    }

    .about-content {
      grid-template-columns: 1fr;
      gap: 32px;
    }

    .lead {
      font-size: 24px;
    }

    .process-grid {
      grid-template-columns: 1fr;
    }
  }

  @media (min-width: 769px) and (max-width: 1024px) {
    .work-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .services-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .services-grid > :global(:nth-child(-n + 3)),
    .services-grid > :global(:nth-child(4)),
    .services-grid > :global(:nth-child(5)) {
      grid-column: span 1;
    }

    .process-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
</style>
